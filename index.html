<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>soft love ‚Äî for you</title>
  <style>
    :root{
      --bgA:#fff4f7;
      --bgB:#ffe1ea;
      --bgC:#ffd1de;
      --red:#ff3b6e;
      --rose:#ff6a8f;
      --pink:#ff9bb4;
      --ink:#2b0f18;
      --shadow: 0 18px 55px rgba(43,15,24,.16);
      --shadow2: 0 12px 35px rgba(43,15,24,.14);
      --r: 26px;
    }

 /* ==== NIGHT MODE SOFT ROSE ==== */
body.night{
  --bgA:#1b0f15;
  --bgB:#24131a;
  --bgC:#2d1720;
  --ink:#ffeaf1;
}

body.night{
  background:
    radial-gradient(1200px 800px at 20% 12%, rgba(255,106,143,.12), transparent 60%),
    radial-gradient(900px 700px at 85% 18%, rgba(255,155,180,.10), transparent 60%),
    linear-gradient(180deg, var(--bgA), var(--bgB) 55%, var(--bgC));
}

body.night .card,
body.night .side,
body.night .stage,
body.night .flip-panel,
body.night .ticketBoard,
body.night .jar,
body.night .paper{
  background: rgba(40,20,28,.75);
  border:1px solid rgba(255,155,180,.18);
  box-shadow: 0 20px 60px rgba(0,0,0,.45);
}

body.night .paper{
  background: rgba(50,25,35,.92);
  color:#ffeaf1;
}

body.night .tile{
  background: rgba(40,20,28,.75);
}

body.night .toast{
  background: rgba(50,25,35,.95);
  color:#ffeaf1;
}

body.night .chip,
body.night .stat,
body.night .metaBox{
  background: rgba(60,28,40,.75);
}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--ink);
      background:
        radial-gradient(1200px 800px at 20% 12%, rgba(255,106,143,.18), transparent 60%),
        radial-gradient(900px 700px at 85% 18%, rgba(255,155,180,.18), transparent 60%),
        radial-gradient(900px 900px at 55% 92%, rgba(255,59,110,.08), transparent 58%),
        linear-gradient(180deg, var(--bgA), var(--bgB) 55%, var(--bgC));
      overflow-x:hidden;
    }
    body:before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.75' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      mix-blend-mode:multiply;
      opacity:.18;
    }

    .app{min-height:100dvh; display:flex; flex-direction:column;}
    header{
      position:sticky; top:0; z-index:50;
      padding:16px 16px 12px;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(255,244,247,.86), rgba(255,244,247,0));
      border-bottom: 1px solid rgba(255,59,110,.10);
    }
    .topbar{
      max-width:1060px; margin:0 auto;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .brand{display:flex; align-items:center; gap:10px; user-select:none;}
    .logo{
      width:40px; height:40px; border-radius:14px;
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.85), rgba(255,255,255,0) 55%),
        linear-gradient(135deg, rgba(255,59,110,.95), rgba(255,155,180,.85));
      box-shadow: 0 14px 30px rgba(255,59,110,.18);
      display:grid; place-items:center;
      border: 1px solid rgba(255,59,110,.18);
      cursor:pointer;
    }
    .logo span{filter: drop-shadow(0 10px 16px rgba(43,15,24,.18))}
    .brand h1{margin:0; font-size:14px; font-weight:950; letter-spacing:.2px; text-transform: lowercase;}
    .brand small{display:block; margin-top:2px; opacity:.72; font-weight:700}

    .pill{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      border: 1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow2);
    }
    .pill button{
      border:0; background:transparent; color:var(--ink);
      font-weight:950; cursor:pointer;
      display:flex; align-items:center; gap:8px;
    }
    .dot{width:8px; height:8px; border-radius:999px; background: rgba(255,59,110,.92); box-shadow: 0 0 0 6px rgba(255,59,110,.12);}

    main{flex:1; padding:16px 16px 96px; max-width:1060px; width:100%; margin:0 auto;}
    .view{display:none; animation: in .25s ease;}
    .view.active{display:block;}
    @keyframes in{from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:translateY(0)}}

    .tilt{transform-style:preserve-3d; transition: transform .12s ease; will-change: transform;}

    .card{
      border-radius: var(--r);
      border: 1px solid rgba(255,59,110,.14);
      background:
        radial-gradient(900px 500px at 18% 12%, rgba(255,255,255,.75), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.45));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card:after{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(circle at 18% 15%, rgba(255,59,110,.10), transparent 40%),
        radial-gradient(circle at 86% 18%, rgba(255,155,180,.18), transparent 45%);
      opacity:.9;
      pointer-events:none;
    }
    .card-inner{position:relative; z-index:1; padding:18px;}
    .title{margin:0 0 6px; font-size: clamp(22px, 3.2vw, 36px); font-weight: 1000; letter-spacing:.1px; line-height:1.05;}
    .sub{margin:0; opacity:.78; font-weight:750; line-height:1.55}

    .grid{margin-top:18px; display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:14px;}
    @media (max-width: 900px){ .grid{grid-template-columns: repeat(2, minmax(0,1fr));} }

    .tile{
      position:relative;
      border-radius: 22px;
      border:1px solid rgba(255,59,110,.14);
      background:
        radial-gradient(420px 280px at 20% 20%, rgba(255,255,255,.70), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.40));
      box-shadow: var(--shadow2);
      padding:14px;
      cursor:pointer;
      transition: transform .15s ease;
      overflow:hidden;
      min-height:152px;
    }
    .tile:hover{transform: translateY(-3px)}
    .tile:active{transform: translateY(-1px)}
    .tile .tag{
      display:inline-flex;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,59,110,.16);
      background: rgba(255,255,255,.55);
      font-weight:1000;
      font-size:12px;
      letter-spacing:.3px;
    }
    .tile h3{margin:12px 0 4px; font-size:16px; font-weight:1000}
    .tile p{margin:0; opacity:.76; font-weight:750; font-size:13px; line-height:1.45}
    .glyph{
      width:56px; height:56px; border-radius:18px;
      border:1px solid rgba(255,59,110,.18);
      background:
        radial-gradient(circle at 30% 25%, rgba(255,255,255,.88), rgba(255,255,255,0) 60%),
        linear-gradient(135deg, rgba(255,59,110,.85), rgba(255,155,180,.78));
      box-shadow: 0 18px 40px rgba(255,59,110,.16);
      display:grid; place-items:center;
      margin-top:12px;
    }
    .glyph span{font-size:26px; filter: drop-shadow(0 10px 16px rgba(43,15,24,.14))}
    .tile .shine{
      position:absolute; inset:-24px;
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,.75), transparent 55%);
      opacity:.85;
      transform: rotate(10deg);
      pointer-events:none;
    }

    .bottom-nav{
      position:fixed; left:0; right:0; bottom:14px;
      display:flex; justify-content:center; gap:12px;
      z-index:60; pointer-events:none;
    }
    .navbtn{
      pointer-events:auto;
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.55);
      color: var(--ink);
      width:54px; height:54px;
      border-radius: 18px;
      box-shadow: var(--shadow2);
      display:grid; place-items:center;
      cursor:pointer;
      backdrop-filter: blur(12px);
      transition: transform .12s ease;
      user-select:none;
      font-size:20px; font-weight:900;
    }
    .navbtn:active{transform: scale(.96)}

    /* Love letter */
    .split{margin-top:14px; display:grid; grid-template-columns: 1.25fr .75fr; gap:14px; align-items:stretch;}
    @media (max-width: 920px){ .split{grid-template-columns:1fr} }

    .paper{
      border-radius: 22px;
      background: rgba(255,255,255,.92);
      color: #1c0a11;
      border: 1px solid rgba(43,15,24,.10);
      box-shadow: 0 18px 55px rgba(43,15,24,.14);
      overflow:hidden;
      position:relative;
    }
    .paper:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(850px 420px at 18% 0%, rgba(255,59,110,.10), transparent 58%),
        radial-gradient(760px 560px at 95% 10%, rgba(255,155,180,.18), transparent 60%);
      pointer-events:none;
      opacity:.95;
    }
    .paper .pad{position:relative; z-index:1; padding:16px;}
    .meta{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; font-size:12px; opacity:.7; font-weight:950;}
    .typebox{
      margin-top:12px;
      border-top: 1px dashed rgba(43,15,24,.18);
      padding-top:12px;
      min-height:230px;
      font-size:15.5px;
      line-height:1.72;
      font-weight:750;
      white-space:pre-wrap;
    }
    .typebox .cursor{display:inline-block; width:10px; border-left: 2px solid rgba(28,10,17,.55); margin-left:2px; transform: translateY(2px); animation: blink .9s step-end infinite;}
    @keyframes blink{50%{opacity:0}}
    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-top:12px;}
    .btn{
      border:0; cursor:pointer;
      padding:10px 12px;
      border-radius: 14px;
      font-weight:1000;
      letter-spacing:.2px;
      color:#fff;
      background: linear-gradient(135deg, rgba(255,59,110,.98), rgba(255,155,180,.92));
      box-shadow: 0 16px 40px rgba(255,59,110,.18);
    }
    .btn.ghost{background: rgba(255,255,255,.60); color: var(--ink); border: 1px solid rgba(255,59,110,.14); box-shadow:none;}
    .hint{font-size:12.5px; opacity:.72; font-weight:800;}

    .side{
      border-radius: 22px;
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
    }
    .side .pad{padding:16px}
    .stat{
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.65);
      padding:12px;
      border-radius: 18px;
      margin-bottom:12px;
    }
    .stat b{display:block; font-size:13px}
    .stat span{opacity:.78; font-weight:750; font-size:13px; line-height:1.5}
    .mini{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    .chip{
      border-radius: 18px;
      padding:12px;
      background: rgba(255,255,255,.65);
      border:1px solid rgba(255,59,110,.14);
      font-weight:1000;
      text-align:left;
      user-select:none;
    }
    .chip small{display:block; opacity:.72; font-weight:800; margin-top:6px}

    /* ---------- COUPON REAL TICKET ---------- */
    .coupon-wrap{margin-top:14px; display:grid; grid-template-columns: 1.05fr .95fr; gap:14px; align-items:start;}
    @media (max-width: 980px){ .coupon-wrap{grid-template-columns:1fr} }

    .ticketBoard{
      border-radius: 26px;
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.58);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .ticketBoard:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 18% 15%, rgba(255,59,110,.10), transparent 45%),
        radial-gradient(circle at 88% 10%, rgba(255,155,180,.18), transparent 48%);
      pointer-events:none;
      opacity:.9;
    }

    .ticketStrip{
      position:relative;
      padding:14px 16px;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      background: rgba(255,255,255,.76);
      border-bottom: 1px solid rgba(255,59,110,.10);
    }
    .ticketStrip b{letter-spacing:.6px; font-weight:1000}
    .code{
      font-weight:1000;
      padding:8px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.82);
      font-size:12px;
    }

    .boardBody{position:relative; padding:16px; display:grid; gap:14px;}
    .boardGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }

    .pass{
      position:relative;
      border-radius: 22px;
      border:1px solid rgba(255,59,110,.16);
      background: rgba(255,255,255,.78);
      overflow:hidden;
      box-shadow: 0 16px 34px rgba(43,15,24,.12);
    }

    .pass:before, .pass:after{
      content:"";
      position:absolute;
      top:44%;
      width:26px; height:26px;
      border-radius:999px;
      background: rgba(255,225,234,.85);
      border:1px solid rgba(255,59,110,.12);
      z-index:3;
    }
    .pass:before{left:-13px}
    .pass:after{right:-13px}
    .tear{
      position:absolute;
      left:0; right:0;
      top:44%;
      border-top: 2px dashed rgba(255,59,110,.22);
      z-index:2;
      opacity:.9;
    }

    .passTop{
      padding:14px 14px 12px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .passTitle{
      display:flex; flex-direction:column; gap:6px;
      min-width: 0;
    }
    .passTitle h4{margin:0; font-weight:1000; letter-spacing:.2px}
    .passTitle p{margin:0; opacity:.80; font-weight:780; font-size:13px; line-height:1.45}
    .valid{
      display:flex; flex-direction:column; align-items:flex-end; gap:6px;
      flex-shrink:0;
    }
    .valid .stamp{
      padding:8px 10px;
      border-radius: 14px;
      border:1px solid rgba(255,59,110,.18);
      background: rgba(255,59,110,.10);
      font-weight:1000;
      color:#a0143a;
      letter-spacing:.5px;
    }
    .valid small{font-weight:1000; opacity:.68}

    .passMid{
      padding:10px 14px 12px;
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width: 520px){ .passMid{grid-template-columns: repeat(2, minmax(0,1fr));} }
    .metaBox{
      border-radius: 16px;
      border:1px solid rgba(255,59,110,.12);
      background: rgba(255,255,255,.70);
      padding:10px;
      box-shadow: 0 10px 18px rgba(43,15,24,.08);
    }
    .metaBox b{display:block; font-weight:1000; font-size:12px; opacity:.72; letter-spacing:.5px}
    .metaBox span{display:block; margin-top:4px; font-weight:1000}

    .passBottom{
      padding:12px 14px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .barcode{
      width:190px;
      height:44px;
      border-radius: 10px;
      border:1px solid rgba(255,59,110,.14);
      background:
        repeating-linear-gradient(90deg,
          rgba(43,15,24,.68) 0px, rgba(43,15,24,.68) 2px,
          transparent 2px, transparent 4px,
          rgba(43,15,24,.35) 4px, rgba(43,15,24,.35) 5px,
          transparent 5px, transparent 8px);
      opacity:.65;
      box-shadow: 0 10px 18px rgba(43,15,24,.08);
    }
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    .pillbtn{
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.88);
      color: var(--ink);
      padding:9px 12px;
      border-radius: 999px;
      font-weight:1000;
      cursor:pointer;
      user-select:none;
    }
    .pillbtn:active{transform:scale(.98)}
    .count{font-weight:1000; opacity:.9; display:flex; align-items:center; gap:8px; font-size:12px;}
    .badge{
      width:22px; height:22px;
      border-radius: 10px;
      background: rgba(255,59,110,.14);
      border: 1px solid rgba(255,59,110,.20);
      display:grid; place-items:center;
    }

    .punch{
      position:absolute;
      top:10px; right:10px;
      width:56px; height:56px;
      border-radius: 18px;
      background: rgba(255,59,110,.16);
      border:1px solid rgba(255,59,110,.18);
      display:grid; place-items:center;
      font-weight:1000;
      opacity:0;
      transform: scale(.6) rotate(-12deg);
      pointer-events:none;
      z-index:5;
    }
    .punch.show{animation: punchPop .55s ease forwards;}
    @keyframes punchPop{
      0%{opacity:0; transform: scale(.6) rotate(-14deg)}
      45%{opacity:1; transform: scale(1.08) rotate(7deg)}
      100%{opacity:0; transform: scale(.9) rotate(0deg)}
    }

    /* stage */
    .stage{
      border-radius: 24px;
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow2);
      padding:16px;
      overflow:hidden;
      position:relative;
      min-height: 340px;
    }
    .stage h3{margin:0 0 8px; font-weight:1000}
    .stage .muted{margin:0; opacity:.78; font-weight:780; line-height:1.5}
    .hugbox{
      margin-top:14px;
      height:220px;
      border-radius: 22px;
      border:1px solid rgba(255,59,110,.12);
      background:
        radial-gradient(520px 280px at 50% 20%, rgba(255,255,255,.85), rgba(255,255,255,0) 60%),
        linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.45));
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
    }
    .avatar{
      width:92px; height:92px;
      border-radius: 28px;
      border:1px solid rgba(255,59,110,.16);
      background:
        radial-gradient(circle at 35% 25%, rgba(255,255,255,.85), rgba(255,255,255,0) 55%),
        linear-gradient(135deg, rgba(255,59,110,.86), rgba(255,155,180,.85));
      box-shadow: 0 18px 40px rgba(255,59,110,.14);
      display:grid; place-items:center;
      position:absolute;
      transition: transform .55s cubic-bezier(.2,.9,.15,1);
      user-select:none;
    }
    .avatar span{font-size:36px; filter: drop-shadow(0 10px 14px rgba(43,15,24,.14))}
    .a1{left:18%; transform: translateX(0) scale(1) rotate(-3deg)}
    .a2{right:18%; transform: translateX(0) scale(1) rotate(3deg)}
    .hug .a1{transform: translateX(74px) scale(1.06) rotate(0deg)}
    .hug .a2{transform: translateX(-74px) scale(1.06) rotate(0deg)}
    .pulse{
      position:absolute;
      left:50%; top:50%;
      width:16px; height:16px;
      border-radius:999px;
      background: rgba(255,59,110,.92);
      box-shadow: 0 0 0 10px rgba(255,59,110,.14);
      opacity:0;
      transform: translate(-50%,-50%);
    }
    .hug .pulse{animation: pop .9s ease forwards;}
    @keyframes pop{
      0%{transform: translate(-50%,-50%) scale(.2); opacity:0}
      25%{opacity:1}
      100%{transform: translate(-50%,-50%) scale(18); opacity:0}
    }
    .floaty{
      position:absolute;
      font-size:18px;
      opacity:0;
      transform: translateY(14px);
    }
    .hug .floaty{animation: floatUp 1.1s ease forwards;}
    @keyframes floatUp{
      0%{opacity:0; transform: translateY(16px) scale(.95)}
      30%{opacity:1}
      100%{opacity:0; transform: translateY(-70px) scale(1.05)}
    }

    /* ---------- SCRAPBOOK book-like pages ---------- */
    .flip-wrap{margin-top:14px; display:grid; grid-template-columns: 1fr .9fr; gap:14px; align-items:start;}
    @media (max-width: 980px){ .flip-wrap{grid-template-columns:1fr} }
.book{
  width: min(520px, 100%);
  height: 460px;
  position:relative;
  margin: 0 auto;
  perspective: 1400px;
  -webkit-perspective: 1400px;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

.pageStack{position:absolute; inset:0;}

.page{
  position:absolute;
  inset:0;
  border-radius: 26px;

  transform-origin: left center;
  transform-style: preserve-3d;
  -webkit-transform-style: preserve-3d;

  will-change: transform;
  transition: transform .12s cubic-bezier(.2,.85,.12,1);

  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;

  overflow: hidden;
  background:#fff;

  box-shadow: 0 16px 45px rgba(43,15,24,.14);
  border: 1px solid rgba(255,59,110,.12);
}

.page .front,
.page .back{
  position:absolute;
  inset:0;

  padding:18px;
  color:#1c0a11;
  background:#fff;

  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;

  transform-style: preserve-3d;
  -webkit-transform-style: preserve-3d;
}

/* penting: front juga harus punya transform biar backface kepake di Android */
.page .front{
  transform: rotateY(0deg) translateZ(1px);
  -webkit-transform: rotateY(0deg) translateZ(1px);
}

.page .back{
  transform: rotateY(180deg) translateZ(1px);
  -webkit-transform: rotateY(180deg) translateZ(1px);
}

.page.flipped{
  transform: rotateY(-180deg);
  -webkit-transform: rotateY(-180deg);
}
      border-radius: 26px;
      transform-origin: left center;
      transform-style: preserve-3d;
      will-change: transform;
      backface-visibility: hidden;
      transition: transform .12s cubic-bezier(.2,.85,.12,1);
      box-shadow: 0 16px 45px rgba(43,15,24,.14);
      border: 1px solid rgba(255,59,110,.12);
      overflow:hidden;
      background: #fff;
    }
    .page .front,
.page .back{
  position:absolute;
  inset:0;

  backface-visibility:hidden;
  -webkit-backface-visibility:hidden;

  padding:18px;
  color:#1c0a11;
  background:#fff;
}

/* anti ‚Äútembus/bleeding‚Äù */
.page .front{ transform: translateZ(0.1px); }
.page .back{ transform: rotateY(180deg) translateZ(0.1px); background:#fff; }
    .paperlines{
      background:
        repeating-linear-gradient(180deg, rgba(43,15,24,.05) 0, rgba(43,15,24,.05) 1px, transparent 1px, transparent 26px);
      opacity:.65; position:absolute; inset:0; pointer-events:none;
    }
    .page .back{transform: rotateY(180deg); background:#fff;}
    .page.flipped{transform: rotateY(-180deg);}
    .pageStack{position:absolute; inset:0;}

    .chapter{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      margin-bottom:10px;
    }
    .chapter h4{margin:0; font-weight:1000; letter-spacing:.2px}
    .chapter .idx{font-weight:1000; opacity:.6}
    .para{
      font-weight:820;
      opacity:.92;
      line-height:1.75;
      font-size:14.5px;
      white-space:pre-wrap;
    }

    /* ====== FIX STICKER: KECIL + NGGAK NUTUP TEKS ====== */
    .sticker{
      position:absolute;
      width:58px;
      height:58px;
      padding:0;
      background:transparent;
      border:none;
      box-shadow:none;
      user-select:none;
      transform: rotate(var(--rot));
      animation: floatSticker 4s ease-in-out infinite;
      z-index:1;              /* DI BAWAH TEKS */
      pointer-events:none;    /* BIAR NGGAK NGANGGU */
    }
    .stickerPic{
      width:100%;
      height:100%;
      background-size:contain;
      background-repeat:no-repeat;
      background-position:center;
      filter: drop-shadow(0 6px 10px rgba(43,15,24,.12));
      opacity:.95;
    }
    .contentSafe{
      position:relative;
      z-index:2;             /* TEKS DI ATAS STIKER */
      padding-right:78px;    /* ruang aman kanan */
      padding-left:10px;
    }
    @keyframes floatSticker{
      0%,100%{transform: rotate(var(--rot)) translateY(0)}
      50%{transform: rotate(calc(var(--rot) + 2deg)) translateY(-6px)}
    }

    .flip-panel{
      border-radius: 24px;
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow2);
      padding:16px;
    }
    .flip-panel h3{margin:0 0 8px; font-weight:1000}
    .flip-panel p{margin:0; opacity:.78; font-weight:780; line-height:1.55}
    .flip-actions{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;}
    .mini-btn{
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.82);
      color: var(--ink);
      padding:10px 12px;
      border-radius: 14px;
      font-weight:1000;
      cursor:pointer;
      user-select:none;
    }
    .mini-btn:active{transform:scale(.98)}
    .pageNo{opacity:.78; font-weight:900}

    /* ---------- MEMORY JAR + CENTER TOAST ---------- */
    .jar-wrap{margin-top:14px; display:grid; grid-template-columns: 1fr .9fr; gap:14px; align-items:start;}
    @media (max-width: 980px){ .jar-wrap{grid-template-columns:1fr} }

    .jar{
      border-radius: 26px;
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      min-height: 420px;
      display:grid;
      place-items:center;
      padding:18px;
    }
    .jarGlass{
      width:min(320px, 92%);
      height:320px;
      border-radius: 44px;
      border:1px solid rgba(255,59,110,.16);
      background:
        radial-gradient(circle at 30% 15%, rgba(255,255,255,.85), transparent 48%),
        linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.45));
      box-shadow: 0 22px 60px rgba(43,15,24,.14);
      position:relative;
      overflow:hidden;
      user-select:none;
      transform-origin: 50% 80%;
      display:grid;
      place-items:center;
      cursor:pointer;
    }
    .jarGlass:active{transform: scale(.99)}
    .jarCap{
      position:absolute; top:-16px; left:50%;
      width:220px; height:60px;
      transform: translateX(-50%);
      border-radius: 22px;
      border:1px solid rgba(255,59,110,.16);
      background: rgba(255,255,255,.78);
      box-shadow: 0 18px 40px rgba(43,15,24,.10);
      display:grid; place-items:center;
      font-weight:1000;
      letter-spacing:.5px;
      color:#a0143a;
    }
    .papers{
      position:absolute; inset:70px 16px 16px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      align-content:start;
      opacity:.95;
    }
    .paperbit{
      height:38px;
      border-radius: 12px;
      border:1px solid rgba(255,59,110,.12);
      background: rgba(255,255,255,.78);
      transform: rotate(var(--rot));
      box-shadow: 0 10px 18px rgba(43,15,24,.10);
    }
    .paperbit:nth-child(1){--rot:-8deg}
    .paperbit:nth-child(2){--rot:6deg}
    .paperbit:nth-child(3){--rot:-4deg}
    .paperbit:nth-child(4){--rot:10deg}
    .paperbit:nth-child(5){--rot:7deg}
    .paperbit:nth-child(6){--rot:-10deg}
    .paperbit:nth-child(7){--rot:5deg}
    .paperbit:nth-child(8){--rot:-6deg}
    .paperbit:nth-child(9){--rot:11deg}
    .paperbit:nth-child(10){--rot:-3deg}
    .paperbit:nth-child(11){--rot:8deg}
    .paperbit:nth-child(12){--rot:-9deg}

    .shake{animation: shake .55s ease}
    @keyframes shake{
      0%{transform: rotate(0deg)}
      20%{transform: rotate(-6deg)}
      40%{transform: rotate(6deg)}
      60%{transform: rotate(-4deg)}
      80%{transform: rotate(4deg)}
      100%{transform: rotate(0deg)}
    }

    .reveal{
      border-radius: 26px;
      border:1px solid rgba(255,59,110,.14);
      background: rgba(255,255,255,.55);
      box-shadow: var(--shadow2);
      padding:16px;
    }
    .reveal h3{margin:0 0 8px; font-weight:1000}
    .tiny{font-size:12.5px; opacity:.78; font-weight:850}

    .toastWrap{
      position:fixed; inset:0;
      display:grid; place-items:center;
      pointer-events:none;
      z-index:999;
    }
    .toast{
      width:min(520px, calc(100% - 32px));
      border-radius: 22px;
      border: 1px solid rgba(255,59,110,.16);
      background: rgba(255,255,255,.78);
      box-shadow: 0 26px 70px rgba(43,15,24,.22);
      padding:14px;
      opacity:0;
      transform: translateY(10px) scale(.98);
      transition: opacity .35s ease, transform .35s ease;
      backdrop-filter: blur(10px);
    }
   .toast.show{
  opacity:1;
  transform: translateY(0) scale(1);
  animation: notifPop .35s ease;
}
@keyframes notifPop{
  0%{transform: translateY(14px) scale(.96); opacity:0}
  100%{transform: translateY(0) scale(1); opacity:1}
}
    .toastTop{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;}
    .toastTitle{display:flex; align-items:center; gap:10px; font-weight:1000;}
    .toastTitle .dot{
      width:9px; height:9px; border-radius:999px;
      background: rgba(255,59,110,.92);
      box-shadow: 0 0 0 6px rgba(255,59,110,.12);
    }
    .toastClose{
      pointer-events:auto;
      border:1px solid rgba(255,59,110,.16);
      background: rgba(255,255,255,.70);
      border-radius: 14px;
      padding:6px 10px;
      font-weight:1000;
      color: var(--ink);
      cursor:pointer;
    }
    .toastMsg{white-space:pre-wrap; line-height:1.65; font-weight:850; opacity:.95;}

    .hearts{position:fixed; inset:0; pointer-events:none; z-index:80}
    .heart{
      position:absolute;
      font-size:18px;
      opacity:0;
      transform: translateY(0) scale(.9);
      animation: fly 1.2s ease forwards;
      filter: drop-shadow(0 16px 22px rgba(43,15,24,.16));
    }
    @keyframes fly{
      0%{opacity:0; transform: translateY(12px) scale(.85)}
      18%{opacity:1}
      100%{opacity:0; transform: translateY(-110px) scale(1.15)}
    }
  </style>
</head>
<body>
  <div class="hearts" id="hearts"></div>

  <div class="toastWrap" aria-live="polite" aria-atomic="true">
    <div class="toast" id="toast">
      <div class="toastTop">
        <div class="toastTitle"><span class="dot"></span><span id="toastHead">a little note</span></div>
        <button class="toastClose" id="toastClose" type="button">ok</button>
      </div>
      <div class="toastMsg" id="toastMsg">‚Ä¶</div>
    </div>
  </div>

  <div class="app">
    <header>
      <div class="topbar">
        <div class="brand">
          <div class="logo" onclick="go('home')" title="Home"><span>üíó</span></div>
          <div>
            <h1>soft love, in one page</h1>
            <small id="dateLine">‚Äî</small>
          </div>
        </div>

        <div class="pill">
          <div class="dot"></div>
          <button onclick="go('home')">home</button>
          <span style="opacity:.55">‚Ä¢</span>
          <button onclick="burst(10)">spark</button>
          <span style="opacity:.55">‚Ä¢</span>
          <!-- NIGHT MODE TOGGLE (added) -->
          <button onclick="toggleNight()">üåô</button>
        </div>
      </div>
    </header>

    <main>
      <!-- HOME -->
      <section class="view active" data-view="home">
        <div class="card tilt" data-tilt>
          <div class="card-inner">
            <h2 class="title">I made this with love,<br>for you‚Äîbecause you‚Äôre precious to me</h2>
            <p class="sub">Klik pelan-pelan ya. Ini bukan buat dibaca cepat. Ini buat dirasain.</p>

            <div class="grid">
              <div class="tile tilt" data-tilt onclick="go('letter')">
                <div class="shine"></div>
                <div class="tag">LOVE LETTER</div>
                <div class="glyph"><span>üíå</span></div>
                <h3>Dear You</h3>
                <p>Ga dibuat-buat, tapi kalau kamu baca semoga hati kamu sedikit lebih tenang.</p>
              </div>

              <div class="tile tilt" data-tilt onclick="go('coupon')">
                <div class="shine"></div>
                <div class="tag">TICKET COUPON</div>
                <div class="glyph"><span>üéüÔ∏è</span></div>
                <h3>Love Pass</h3>
                <p>Redeem hal manis yang bikin hati kamu pelan-pelan adem.</p>
              </div>

              <div class="tile tilt" data-tilt onclick="go('scrap')">
                <div class="shine"></div>
                <div class="tag">FLIPBOOK</div>
                <div class="glyph"><span>üìñ</span></div>
                <h3>Our Pages</h3>
                <p>Tiap halaman kayak buku kecil. Ada stiker lucu juga.</p>
              </div>

              <div class="tile tilt" data-tilt onclick="go('jar')">
                <div class="shine"></div>
                <div class="tag">SHAKE JAR</div>
                <div class="glyph"><span>ü´ô</span></div>
                <h3>Memory Jar (tap/shake)</h3>
                <p>Tap jar-nya, pesan muncul di tengah kayak notif.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- LOVE LETTER -->
      <section class="view" data-view="letter">
        <div class="card tilt" data-tilt>
          <div class="card-inner">
            <h2 class="title">Love Letter üíå</h2>
            <p class="sub">Aku taruh di sini ya, jadi biar kapan pun kamu buka tetap kerasa.</p>

            <div class="split">
              <div class="paper tilt" data-tilt>
                <div class="pad">
                  <div class="meta">
                    <div><b>Date:</b> <span id="today">‚Äî</span></div>
                    <div>soft pink edition</div>
                  </div>

                  <div class="typebox" id="typebox"></div>

                  <div class="actions">
                    <button class="btn" onclick="retype()">replay ‚ú®</button>
                    <button class="btn ghost" onclick="toast('small thing','Kalau kepalamu lagi rame.\nGak semua harus selesai sekarang\nAku tetap ada di sini.')">tap me</button>
                    <span class="hint">kalau kamu senyum dikit aja, itu udah menang.</span>
                  </div>
                </div>
              </div>

              <div class="side tilt" data-tilt>
                <div class="pad">
                  <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;">
                    <button class="pillbtn" onclick="openWhen('tired')">open when tired</button>
                    <button class="pillbtn" onclick="openWhen('doubt')">open when you doubt yourself</button>
                    <button class="pillbtn" onclick="openWhen('miss')">open when you miss me</button>
                    <button class="pillbtn" onclick="openWhen('overthink')">open when overthinking</button>
                  </div>

                  <div class="stat">
                    <b>Kalimat kecil yang aku pegang</b>
                    <span>
                      Aku gak mau jadi yang cuma hadir pas semuanya baik-baik aja.
                      Aku maunya ada juga pas kamu lagi ga baik-baik aja
                      dan tetap bilang: ‚Äúgapapa,aku disini.‚Äù
                    </span>
                  </div>

                  <div class="mini">
                    <div class="chip"><div style="font-size:18px">ü´∂</div><small>buat malam sepi: buka jar, terus tap.</small></div>
                    <div class="chip"><div style="font-size:18px">üéüÔ∏è</div><small>buat kangen mendadak: redeem tiket peluk.</small></div>
                    <div class="chip"><div style="font-size:18px">üìñ</div><small>buat mood jelek: flip halaman pelan-pelan.</small></div>
                    <div class="chip"><div style="font-size:18px">üå∑</div><small>buat kamu makasih udah bertahan.</small></div>
                  </div>

                  <p class="hint" style="margin-top:12px;">
                    Ini surat yang paling jujur: aku suka kamu, tanpa syarat yang ribet.
                  </p>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>

      <!-- COUPON (REAL TICKETS) -->
      <section class="view" data-view="coupon">
        <div class="card tilt" data-tilt>
          <div class="card-inner">
            <h2 class="title">Ticket Coupon üéüÔ∏è</h2>
            <p class="sub">Tiketnya beneran ‚Äúreal look‚Äù. Redeem kalau kamu butuh ditenangin.</p>

            <div class="coupon-wrap">
              <div class="ticketBoard tilt" data-tilt>
                <div class="ticketStrip">
                  <b>LOVE PASS</b>
                  <div class="code">#<span id="couponCode">‚Äî</span></div>
                </div>

                <div class="boardBody">
                  <div class="boardGrid">

                    <div class="pass">
                      <div class="punch" id="p_hug">VALID</div>
                      <div class="tear"></div>

                      <div class="passTop">
                        <div class="passTitle">
                          <h4>HUG PASS ü´Ç</h4>
                          <p>Peluk versi pelan bukan buru-buru, bukan nyuruh kamu kuat.tapi cuma nemenin.</p>
                        </div>
                        <div class="valid">
                          <div class="stamp">VALID</div>
                          <small>admit one</small>
                        </div>
                      </div>

                      <div class="passMid">
                        <div class="metaBox"><b>GATE</b><span>H-04</span></div>
                        <div class="metaBox"><b>SEAT</b><span>2B</span></div>
                        <div class="metaBox"><b>ZONE</b><span>SOFT</span></div>
                        <div class="metaBox"><b>TIME</b><span>NOW</span></div>
                      </div>

                      <div class="passBottom">
                        <div class="barcode" aria-hidden="true"></div>
                        <div class="controls">
                          <button class="pillbtn" onclick="redeem('hug')">redeem</button>
                          <div class="count"><span class="badge" id="c_hug">0</span> used</div>
                        </div>
                      </div>
                    </div>

                    <div class="pass">
                      <div class="punch" id="p_kiss">VALID</div>
                      <div class="tear"></div>

                      <div class="passTop">
                        <div class="passTitle">
                          <h4>KISS PASS üíã</h4>
                          <p>Kiss yang kecil tapi niat. Yang selalu bilang: ‚Äútenang kamu aman.‚Äù</p>
                        </div>
                        <div class="valid">
                          <div class="stamp">VALID</div>
                          <small>admit one</small>
                        </div>
                      </div>

                      <div class="passMid">
                        <div class="metaBox"><b>GATE</b><span>K-01</span></div>
                        <div class="metaBox"><b>SEAT</b><span>1A</span></div>
                        <div class="metaBox"><b>ZONE</b><span>CALM</span></div>
                        <div class="metaBox"><b>TIME</b><span>NOW</span></div>
                      </div>

                      <div class="passBottom">
                        <div class="barcode" aria-hidden="true"></div>
                        <div class="controls">
                          <button class="pillbtn" onclick="redeem('kiss')">redeem</button>
                          <div class="count"><span class="badge" id="c_kiss">0</span> used</div>
                        </div>
                      </div>
                    </div>

                    <div class="pass">
                      <div class="punch" id="p_hold">VALID</div>
                      <div class="tear"></div>

                      <div class="passTop">
                        <div class="passTitle">
                          <h4>HOLD HAND PASS ü§ù</h4>
                          <p>Pas kamu ragu, aku bakalan bilanh ‚Äúayo pelan-pelan‚Äù bukan harus ‚Äúayo cepet‚Äù.</p>
                        </div>
                        <div class="valid">
                          <div class="stamp">VALID</div>
                          <small>admit one</small>
                        </div>
                      </div>

                      <div class="passMid">
                        <div class="metaBox"><b>GATE</b><span>H-07</span></div>
                        <div class="metaBox"><b>SEAT</b><span>3C</span></div>
                        <div class="metaBox"><b>ZONE</b><span>SAFE</span></div>
                        <div class="metaBox"><b>TIME</b><span>NOW</span></div>
                      </div>

                      <div class="passBottom">
                        <div class="barcode" aria-hidden="true"></div>
                        <div class="controls">
                          <button class="pillbtn" onclick="redeem('hold')">redeem</button>
                          <div class="count"><span class="badge" id="c_hold">0</span> used</div>
                        </div>
                      </div>
                    </div>

                    <div class="pass">
                      <div class="punch" id="p_safe">VALID</div>
                      <div class="tear"></div>

                      <div class="passTop">
                        <div class="passTitle">
                          <h4>SAFE DAY PASS üß∏</h4>
                          <p>Kalau hari kamu berat, ini tiket buat ditenangin bukan dihakimi.</p>
                        </div>
                        <div class="valid">
                          <div class="stamp">VALID</div>
                          <small>admit one</small>
                        </div>
                      </div>

                      <div class="passMid">
                        <div class="metaBox"><b>GATE</b><span>S-09</span></div>
                        <div class="metaBox"><b>SEAT</b><span>7D</span></div>
                        <div class="metaBox"><b>ZONE</b><span>HOME</span></div>
                        <div class="metaBox"><b>TIME</b><span>NOW</span></div>
                      </div>

                      <div class="passBottom">
                        <div class="barcode" aria-hidden="true"></div>
                        <div class="controls">
                          <button class="pillbtn" onclick="redeem('safe')">redeem</button>
                          <div class="count"><span class="badge" id="c_safe">0</span> used</div>
                        </div>
                      </div>
                    </div>

                  </div>

                  <p class="hint" style="margin:0;">
                    Tiap redeem ada sound kecil biar rasanya ‚Äúklik‚Äù.
                  </p>
                </div>
              </div>

              <div class="stage tilt" data-tilt>
                <h3 id="stageTitle">Animation stage ‚ú®</h3>
                <p class="muted" id="stageDesc">Tekan redeem. Lihat efeknya di sini.</p>

                <div class="hugbox" id="hugbox">
                  <div class="pulse" id="pulse"></div>
                  <div class="avatar a1"><span>üßç‚Äç‚ôÇÔ∏è</span></div>
                  <div class="avatar a2"><span>üßç‚Äç‚ôÄÔ∏è</span></div>
                  <div class="floaty" id="float1" style="left:35%; bottom:30px;">üíó</div>
                  <div class="floaty" id="float2" style="left:52%; bottom:22px;">‚ú®</div>
                  <div class="floaty" id="float3" style="left:62%; bottom:28px;">ü´∂</div>
                </div>

                <div class="hint" style="margin-top:12px;">
                  Redeem kalau kamu kangen sama kita
                </div>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- SCRAPBOOK (BOOK-LIKE) -->
      <section class="view" data-view="scrap">
        <div class="card tilt" data-tilt>
          <div class="card-inner">
            <h2 class="title">Scrapbook Flipbook üìñ</h2>
            <p class="sub">Tiap halaman kayak buku kecil. Tulisan beda-beda, bukan template.</p>

            <div class="flip-wrap">
              <div class="tilt" data-tilt>
                <div class="book" aria-label="flipbook">
                  <div class="spine"></div>
                  <div class="pageStack" id="pageStack"></div>
                </div>
              </div>

              <div class="flip-panel tilt" data-tilt>
                <h3>pages</h3>
                <p>Flip pelan-pelan yaa. Ini versi ‚Äúmakasih‚Äù yang aku simpen lama.</p>

                <div class="flip-actions">
                  <button class="mini-btn" onclick="prevFlip()">‚Üê prev</button>
                  <button class="mini-btn" onclick="nextFlip()">next ‚Üí</button>
                  <span class="pageNo" id="pageNo">page 1</span>
                </div>

                <p class="tiny" style="margin-top:10px;">
                  Ada stiker yang goyang kecil biar lucu üòÑ
                </p>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- MEMORY JAR -->
      <section class="view" data-view="jar">
        <div class="card tilt" data-tilt>
          <div class="card-inner">
            <h2 class="title">Memory Jar ü´ô</h2>
            <p class="sub">Tap atau shake. Pesan muncul di tengah kayak notif kecil.</p>

            <div class="jar-wrap">
              <div class="jar tilt" data-tilt>
                <div class="jarGlass" id="jarGlass" title="tap to shake">
                  <div class="jarCap">TAP ME</div>
                  <div class="papers" aria-hidden="true">
                    <div class="paperbit"></div><div class="paperbit"></div><div class="paperbit"></div><div class="paperbit"></div>
                    <div class="paperbit"></div><div class="paperbit"></div><div class="paperbit"></div><div class="paperbit"></div>
                    <div class="paperbit"></div><div class="paperbit"></div><div class="paperbit"></div><div class="paperbit"></div>
                  </div>
                </div>
              </div>

              <div class="reveal tilt" data-tilt>
                <h3>How to</h3>
                <p class="tiny" style="margin:0; line-height:1.55;">
                  - Tap jar untuk ‚Äúshake‚Äù.<br>
                  - Pesan akan muncul di tengah layar.<br>
                  - Tap lagi kalau kamu butuh lagi.
                </p>
                <p class="tiny" style="margin-top:10px;">
                  Jar ini isinya banyak, biar kamu gak kehabisan pegangan.
                </p>
              </div>
            </div>

          </div>
        </div>
      </section>

    </main>

    <div class="bottom-nav" id="bottomNav" style="display:none;">
      <div class="navbtn" onclick="back()" title="Back">‚Ü©Ô∏è</div>
      <div class="navbtn" onclick="go('home')" title="Home">üè†</div>
    </div>
  </div>

  <script>
    /* router */
    const views = [...document.querySelectorAll(".view")];
    const bottomNav = document.getElementById("bottomNav");
    const historyStack = [];
    function show(view){
      views.forEach(v => v.classList.toggle("active", v.dataset.view === view));
      bottomNav.style.display = (view === "home") ? "none" : "flex";
      location.hash = view;
    }
    function go(view){
      const current = document.querySelector(".view.active")?.dataset.view;
      if(current && current !== view) historyStack.push(current);
      show(view); burst(8);
    }
    function back(){ show(historyStack.pop() || "home"); }
    window.addEventListener("hashchange", ()=> show((location.hash || "#home").replace("#","")));

    /* date */
    const dateLine = document.getElementById("dateLine");
    const todayEl = document.getElementById("today");
    const d = new Date();
    const opts = { year:'numeric', month:'short', day:'2-digit' };
    const s = d.toLocaleDateString('id-ID', opts);
    dateLine.textContent = s;
    todayEl.textContent = s;
    /* tilt */
    function bindTilt(el){
      const max = 9;
      el.addEventListener("mousemove", (e)=>{
        const r = el.getBoundingClientRect();
        const x = e.clientX - r.left;
        const y = e.clientY - r.top;
        const rx = ((y / r.height) - 0.5) * -max;
        const ry = ((x / r.width)  - 0.5) *  max;
        el.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(0)`;
      });
      el.addEventListener("mouseleave", ()=>{ el.style.transform = `perspective(900px) rotateX(0deg) rotateY(0deg)`; });
      el.addEventListener("touchstart", ()=>{ el.style.transform = `perspective(900px) rotateX(0deg) rotateY(0deg)`; }, {passive:true});
    }
    document.querySelectorAll("[data-tilt]").forEach(bindTilt);

    /* hearts */
    const hearts = document.getElementById("hearts");
    function heartOnce(){
      const h = document.createElement("div");
      h.className = "heart";
      const emojis = ["üíó","üíû","üíñ","‚ú®","ü´∂","üå∑","üéÄ"];
      h.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      h.style.left = (10 + Math.random()*80) + "vw";
      h.style.top  = (70 + Math.random()*22) + "vh";
      h.style.fontSize = (16 + Math.random()*18) + "px";
      hearts.appendChild(h);
      setTimeout(()=>h.remove(), 1400);
    }
    function burst(n=10){ for(let i=0;i<n;i++) setTimeout(heartOnce, i*40); }

    /* sound */
    let audioCtx = null;
    function chime(freq=620, dur=0.24){
      try{
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const t0 = audioCtx.currentTime;
        const o1 = audioCtx.createOscillator();
        const o2 = audioCtx.createOscillator();
        const g  = audioCtx.createGain();
        o1.type = "sine"; o2.type = "triangle";
        o1.frequency.setValueAtTime(freq, t0);
        o2.frequency.setValueAtTime(freq*1.5, t0);
        o1.frequency.exponentialRampToValueAtTime(freq*1.12, t0+0.08);
        o2.frequency.exponentialRampToValueAtTime(freq*1.25, t0+0.10);
        g.gain.setValueAtTime(0.0001, t0);
        g.gain.exponentialRampToValueAtTime(0.12, t0+0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, t0+dur);
        o1.connect(g); o2.connect(g); g.connect(audioCtx.destination);
        o1.start(t0); o2.start(t0);
        o1.stop(t0+dur+0.02); o2.stop(t0+dur+0.02);
      }catch(e){}
    }

    /* toast */
    const toastEl = document.getElementById("toast");
    const toastHead = document.getElementById("toastHead");
    const toastMsg = document.getElementById("toastMsg");
    const toastClose = document.getElementById("toastClose");
    let toastTimer = null;
    function toast(head, msg, ms=3200){
      toastHead.textContent = head;
      toastMsg.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>toastEl.classList.remove("show"), ms);
      burst(8);
    }
    toastClose.addEventListener("click", ()=>toastEl.classList.remove("show"));

    /* Love letter typewriter */
    const typebox = document.getElementById("typebox");
    const letterText =
`Hai bby.
Aku gak mau bikin kata-kata yang heboh.
Aku cuma pengen kamu tau satu hal yang simple tapi penting.

Kalau hari kamu lagi berat,
aku pengen jadi orang yang gak nyuruh kamu kuat
tapi nyediain tempat buat kamu istirahat.

Kalau kamu lagi seneng,
aku pengen jadi yang ikut seneng tanpa ngambil panggungnya.

Aku suka kamu yang kadang bawel,kadang diem,
kadang pura-pura ‚Äúgapapa‚Äù.

Dan kalau ada hari di mana kamu ngerasa kecil,
aku mau kamu ingat di mataku, kamu selalu layak disayang.

Valentine ini cuma alasan biar aku bilang,
aku milih kamu selalu.

‚Äî aku`;

    let typingTimer = null;
    function typeText(text){
      clearInterval(typingTimer);
      typebox.textContent = "";
      const cursor = document.createElement("span");
      cursor.className = "cursor";
      typebox.appendChild(cursor);
      let i = 0;
      typingTimer = setInterval(()=>{
        cursor.insertAdjacentText("beforebegin", text[i] || "");
        i++;
        if(i >= text.length){
          clearInterval(typingTimer);
          burst(14);
          chime(560, .22);
        }
      }, 18);
    }
    function retype(){ typeText(letterText + "\n"); }
    retype();

    /* coupon interactions */
    document.getElementById("couponCode").textContent = String(Math.floor(1000 + Math.random()*9000));
    const hugbox = document.getElementById("hugbox");
    const stageTitle = document.getElementById("stageTitle");
    const stageDesc  = document.getElementById("stageDesc");
    const float1 = document.getElementById("float1");
    const float2 = document.getElementById("float2");
    const float3 = document.getElementById("float3");
    const counts = {hug:0, kiss:0, hold:0, safe:0};
    let unlocked = false;

    function checkUnlock(){
      if(unlocked) return;

      const allUsed =
        counts.hug > 0 &&
        counts.kiss > 0 &&
        counts.hold > 0 &&
        counts.safe > 0;

      if(allUsed){
        unlocked = true;
        setTimeout(()=>{
          toast("secret unlocked",
`Semua tiket sudah pernah kamu pakai.
Artinya kamu tau kapan harus dipeluk,
kapan harus ditenangin,
dan kapan harus ditemenin.

Dan aku tetap di sini,
tanpa batas redeem.`, 5200);
          burst(20);
          chime(720,.28);
        }, 600);
      }
    }

    function setStage(kind){
      const map = {
        hug:  ["HUG PASS ü´Ç", "Tarik napas pelan. Aku peluk kamu dari jauh yang penting kamu gak sendirian."],
        kiss: ["KISS PASS üíã", "Ini versi kecil tapi niat: ‚Äòtenang yaa kamu aman, kamu gak harus kuat terus.‚Äô"],
        hold: ["HOLD HAND PASS ", "Pegang tanganku dulu. Kita gak harus sampai cepat yang penting sampai bareng."],
        safe: ["SAFE DAY PASS üß∏", "Kalau hari kamu berat, sini kita jalanin pelan-pelan bersama."]
      };
      stageTitle.textContent = map[kind][0];
      stageDesc.textContent  = map[kind][1];
    }
    function animate(kind){
      hugbox.classList.remove("hug");
      void hugbox.offsetWidth;
      if(kind === "hug"){ float1.textContent="ü´Ç"; float2.textContent="üíó"; float3.textContent="ü´∂"; }
      if(kind === "kiss"){ float1.textContent="üíã"; float2.textContent="üå∑"; float3.textContent="‚ú®"; }
      if(kind === "hold"){ float1.textContent="ü§ù"; float2.textContent="üíû"; float3.textContent="‚ú®"; }
      if(kind === "safe"){ float1.textContent="üß∏"; float2.textContent="üíó"; float3.textContent="ü´ß"; }
      hugbox.classList.add("hug");
      setTimeout(()=>hugbox.classList.remove("hug"), 900);
    }
    function punch(id){
      const el = document.getElementById(id);
      el.classList.remove("show");
      void el.offsetWidth;
      el.classList.add("show");
    }
    function redeem(kind){
      counts[kind] += 1;
      document.getElementById("c_"+kind).textContent = counts[kind];
      setStage(kind);
      animate(kind);
      burst(12);
      const snd = {hug:680, kiss:740, hold:620, safe:560};
      chime(snd[kind] || 620, .24);
      punch({hug:"p_hug", kiss:"p_kiss", hold:"p_hold", safe:"p_safe"}[kind]);
      const follow = {
  hug:  "Ini peluk yang gak buru-buru.\nKamu boleh diem, aku tetap disini (secara diam-diam).",
  kiss: "Kiss kecil.\nBiar kepalamu berhenti ribut sebentar.\nkamu aman.",
  hold: "Sini tanganmu.\nKita jalan pelan-pelan.\ngak perlu menang hari ini.",
  safe: "Kalau kamu capek jadi kuat,\nhari ini kamu boleh jadi ‚Äòdisayang‚Äô dulu."
};
      toast("ticket redeemed", follow[kind], 3600);
      checkUnlock();
    }

    /* scrapbook book-like pages (FIXED) */
    const flipData = [
      {
        title:"Bab 1 ‚Äî Makasih ya",
        text:
`Aku sering lupa bilang makasih dengan cara yang bener.
Jadi aku tulis di sini, biar kamu bisa baca kapan pun kamu butuh diingetin.

Makasih yaa kamu selalu ada.
Bukan cuma pas aku lagi lucu atau lagi gampang disayang,
tapi juga pas aku lagi capek, lagi penuh pikiran,
atau lagi gak pinter ngejelasin apa yang aku rasain.
Kamu hadirnya gak ribut, tapi bikin aku merasa ‚Äúoh aku gak sendirian‚Äù.

Kalau suatu hari kamu ngerasa kamu ‚Äúgak ngapa-ngapain‚Äù,
aku pengen kamu tau hadir kamu itu cukup banget.`,
        sticker:{img:"0.png", x:"18px", y:"78px", rot:"-7deg"},
        sticker2:{img:"1.png", x:"280px", y:"52px", rot:"7deg"},
        sticker3:{img:"4.png", x:"210px", y:"120px", rot:"-4deg"},
      },
      {
        title:"Bab 2 ‚Äî Cara Kamu Nemenin",
        text:
`Ada orang yang bisa bilang ‚Äúaku di sini‚Äù.
Tapi kamu beneran bikin aku ngerasa ditemenin.
Kamu gak selalu punya jawaban,
tapi kamu selalu punya ruang.
Ruang buat aku cerita pelan-pelan,
ruang buat aku ngeluh tanpa ditertawain,
ruang buat aku istirahat tanpa dituntut jadi kuat terus.
Makasih yaa,udah jadi tempat yang bikin aku ngerasa aman. Kalau kamu capek,
aku juga pengen gantian jagain kamu.`,
        sticker:{img:"9.png", x:"20px", y:"72px", rot:"-8deg"},
        sticker2:{img:"10.png", x:"270px", y:"60px", rot:"8deg"},
        sticker3:img:"12.png", x:"210px", y:"128px", rot:"-5deg"},
      },

      {
        title:"Bab 3 ‚Äî Kalau Kita Lagi Jauh",
        text:
`Jarak itu kadang nyebelin.
Bukan karena kita kurang sayang,
tapi karena kita pengen dekat dan gak bisa.
Tapi aku suka satu hal:
meski jauh, kamu tetap ‚Äúnyampe‚Äù.
Lewat perhatian kecil,
lewat cara kamu nanya kabarku,
lewat sabarmu waktu aku lagi slow respon,
lewat cara kamu bikin aku gak ngerasa sendirian.
Kalau suatu hari jarak bikin kamu sedih,
ingat ya:
kita boleh jauh,
tapi kita gak harus sendirian.`,
        sticker:{img:"14.png", x:"18px", y:"82px", rot:"-7deg"},
        sticker2:{img:"16.png", x:"282px", y:"54px", rot:"7deg"},
        sticker3:{img:"19.png", x:"205px", y:"130px", rot:"-3deg"},
      },

      {
        title:"Bab 4 ‚Äî Aku Bangga Sama Kamu",
        text:
`Aku bangga sama kamu.
Bukan cuma pas kamu ‚Äúberhasil‚Äù,
tapi juga pas kamu tetap jalan meski capek.
Aku notice hal-hal yang orang lain mungkin gak lihat:
cara kamu bertahan,
cara kamu tetap baik di hari yang berat,
cara kamu tetap peduli meski kamu sendiri lagi butuh dipeluk.
Kalau kamu lagi ngerasa kecil,
aku pengen kamu pinjem mataku sebentar:
kamu itu berharga dan kamu layak disayang.`,
        sticker:{img:"24.png", x:"20px", y:"74px", rot:"-8deg"},
        sticker2:{img:"27.png", x:"270px", y:"58px", rot:"8deg"},
        sticker3:{img:"28.png", x:"210px", y:"122px", rot:"-4deg"},
      },

      {
        title:"Bab 5 ‚Äî Aku Milih Kamu",
        text:
`Aku gak jago bikin kalimat romantis yang rapi.
Tapi aku jago milih kamu.
Aku milih kamu pas kamu santai.
Aku milih kamu pas kamu capek.
Aku milih kamu pas kamu bingung.
Aku milih kamu pas kamu ‚Äúgapapa‚Äù padahal gak.
Dan kalau suatu hari kita lagi beda mood,
aku gak mau kita main tebak-tebakan.
Kita ngobrol, pelan, jujur sambil tetap ingat kita masih milih satu sama lain. Aku sayang kamu banyak banget bby.`,
        sticker:{img:"29.png", x:"18px", y:"84px", rot:"-7deg"},
        sticker2:{img:"30.png", x:"280px", y:"60px", rot:"7deg"},
        sticker3:{img:"35.png", x:"205px", y:"126px", rot:"-3deg"},
      },
    ];

    const pageStack = document.getElementById("pageStack");
    const pageNo = document.getElementById("pageNo");
    let flipIndex = 0;

    function pageHTML(d, idx){
      return `
        <div class="paperlines"></div>

        <div class="sticker" style="--rot:${d.sticker.rot}; left:${d.sticker.x}; top:${d.sticker.y};">
          <div class="stickerPic" style="background-image:url('${d.sticker.img}')"></div>
        </div>

        <div class="sticker" style="--rot:${d.sticker2.rot}; left:${d.sticker2.x}; top:${d.sticker2.y};">
          <div class="stickerPic" style="background-image:url('${d.sticker2.img}')"></div>
        </div>

        <div class="sticker" style="--rot:${d.sticker3.rot}; left:${d.sticker3.x}; top:${d.sticker3.y};">
          <div class="stickerPic" style="background-image:url('${d.sticker3.img}')"></div>
        </div>

        <div class="contentSafe">
          <div class="chapter">
            <h4>${d.title}</h4>
            <div class="idx">${String(idx+1).padStart(2,"0")}</div>
          </div>

          <div class="para">${d.text}</div>
        </div>
      `;
    }

    function buildFlipbook(){
      pageStack.innerHTML = "";
      for(let i=flipData.length-1;i>=0;i--){
        const p = document.createElement("div");
        p.className = "page";
        p.dataset.i = i;
        p.style.zIndex = String(1000 - i);

        const front = document.createElement("div");
        front.className = "front";
        front.innerHTML = pageHTML(flipData[i], i);

        const back = document.createElement("div");
        back.className = "back";
        back.innerHTML = `
          <div class="paperlines"></div>
          <div class="contentSafe">
            <div class="chapter">
              <h4>Hal kecil</h4>
              <div class="idx">..</div>
            </div>
            <div class="para">Kalau kamu baca ini\nberarti kamu lagi kangen.\n\naku juga.\nbeneran.</div>
          </div>
        `;
        p.appendChild(front);
        p.appendChild(back);
        pageStack.appendChild(p);
      }
      updateFlipUI();
    }
    function updateFlipUI(){
      const pages = [...document.querySelectorAll(".page")];
      pages.forEach(pg=>{
        const i = Number(pg.dataset.i);
        pg.classList.toggle("flipped", i < flipIndex);
      });
      pageNo.textContent = `page ${Math.min(flipIndex+1, flipData.length)} / ${flipData.length}`;
    }
    function nextFlip(){
      if(flipIndex < flipData.length){
        flipIndex++;
        updateFlipUI();
        burst(10);
        chime(640, .22);
      }
    }
    function prevFlip(){
      if(flipIndex > 0){
        flipIndex--;
        updateFlipUI();
        burst(8);
        chime(560, .20);
      }
    }
    buildFlipbook();

    /* memory jar: MANY messages */
    const jarGlass = document.getElementById("jarGlass");
    const jarMessages = [
      "Kalau hari ini kamu ngerasa ‚Äòkok aku sendirian yaa‚Äô\nAku pengen kamu tau\naku disini.\nBukan cuma pas kamu seneng tapi pas kamu lelah juga.",
      "Reminder kecil:\nKamu gak harus menang tiap hari.\nCukup bertahan.\naku bangga.",
      "Kalau kamu butuh pelukan,\nini peluk versi aku.\nYang nempel bukan yang buru-buru.",
      "Kalau kamu lagi capek ngomong,\ngak usah jelasin panjang.\nCukup bilang:\n‚Äòaku butuh ditemenin.‚Äô",
      "Aku notice hal-hal kecil yang kamu lakukan.\nMakasih yaa kamu selalu ada.",
      "Boleh yaa,\nkalau kamu lagi berat,\nkamu sandar sebentar di sini.\nAku gak kemana-mana.",
      "Ada orang yang tiap lihat notifikasi dari kamu\nlangsung mood-nya naik.\nItu aku.",
      "Kalau kepalamu rame,\nnapas dulu.\nSatu-satu \nAku temenin.",
      "Kamu gak berlebihan.\nKamu cuma lagi capek\ndan itu valid.",
      "Kalau kamu sedih,\nkamu gak perlu keliatan baik-baik dulu.\nKamu boleh ngerasa sedih.",
      "Aku suka kamu yang apa adanya.\nTermasuk versi capeknya.",
      "Kalau hari ini berat,\nkita bikin ringan bareng.\nWalau cuma sedikit.",
      "Aku sayang kamu.\nBukan karena kamu sempurna.\nTapi karena itu kamu.",
      "Kamu aman di sini.\ngak ada tuntutan.\ngak ada ‚Äòharus‚Äô.",
      "Kalau kamu ragu,\naku pegang tanganmu dulu.\nKita jalan pelan-pelan.",
      "Hari ini kamu boleh jadi ‚Äòdisayang‚Äô dulu.\ngak usah jadi kuat.",
      "Aku percaya kamu bisa lewatin ini.\nDan kalau gak bisa hari ini,\nkita coba lagi besok.",
      "Kamu gak sendirian.\nSerius.",
      "Kalau kamu ngerasa kecil,\nkamu harus inget\nkamu itu berharga.",
      "Aku pengen jadi tempat pulang.\nWalau dari jauh.",
      "Jangan lupa makan ya.\nIni bukan cerewet ini tanda sayang.",
      "Aku kangen.\ndan tiap inget kamu, rasanya kayak pengen pulang.",
      "Kalau kamu butuh ditemenin, bilang.\nAku gak bisa baca pikiran,\ntapi aku bisa hadir.",
      "Kamu gak harus punya jawaban sekarang.\nKita pelan-pelan.",
      "Kalau kamu jatuh\ngapapa.\nYang penting kamu gak jatuh sendirian.",
      "Aku milih kamu.\nhari ini dan seterusnya.",
      "Notif kecil:\n‚Äòaku sayang kamu.‚Äô",
      "Kalau kamu lagi overthinking,\naku titip satu kalimat:\n‚Äògak semua hal harus beres malam ini.‚Äô",
      "Kalau kamu ngerasa gagal,\nitu bukan akhir cerita.\nItu cuma bab yang lagi berat.",
      "Aku gak butuh kamu selalu kuat.\nAku butuh kamu jujur.\nBiar aku bisa jagain kamu juga.",
      "Kalau kamu capek jadi ‚Äòbaik-baik aja‚Äô,\ndi sini kamu boleh jujur.",
      "Pelan bukan berarti kalah.\nKadang justru itu cara paling aman buat sampai.",
      "Kalau kamu lagi takut,\ngapapa aku tetap di tim kamu.",
      "Aku suka cara kamu bertahan.\nMeski kamu sendiri gak sadar itu hebat.",
      "Kalau hari ini gak sesuai rencana,gak apa-apa kamu tetap berharga.",
      "Aku pengen kamu tidur tanpa beban.\nKalau bisa, biar aku yang bawa separuhnya.",
      "Kamu layak dicintai,\ngak harus ‚Äòpantas‚Äô dulu.",
      "Kalau kamu lagi merasa gak cukup,\ndi mataku kamu selalu lebih dari cukup.",
       "Aku gak butuh kamu jadi sempurna.\nAku cuma butuh kamu tetap jadi kamu.",
        "Kalau kamu lagi ngerasa jauh dari siapa-siapa\naku masih anggap kamu rumah.",
        "Kadang cinta itu bukan soal besar.\nKadang cuma soal tetap ada.",
      "Aku ada kalau kamu butuh pelan,\nkita pelan.\nkalau kamu butuh diam,\naku diam bareng."
    ];

    /* FIXED: openWhen (no text changes, only quotes fixed) */
function openWhen(type){
  const notes = {
    tired: `Kalau kamu lagi lelah banget,
jangan paksa diri jadi versi paling kuatmu.
Versi yang lagi capek juga tetap layak disayang.`,

    doubt: `Kalau kamu mulai ragu sama diri sendiri,
aku mau kamu tau,
aku gak pernah ragu milih kamu.`,

    miss: `Kalau kamu kangen,
jangan ditahan terus.
Rindu itu bukan beban,
itu tanda ada yang berarti.`,

    overthink: `Kalau pikiranmu lagi ribut,
coba pelanin.
gak semua hal harus kamu pecahin malam ini.
Sebagian bisa tunggu pagi.`
  };

  toast("open when", notes[type], 4200);
  burst(10);
  chime(620,.22);
}
    function jarShake(){
      jarGlass.classList.remove("shake");
      void jarGlass.offsetWidth;
      jarGlass.classList.add("shake");

      const msg = jarMessages[Math.floor(Math.random() * jarMessages.length)];
      toast("memory jar", msg, 4200);
      chime(600, .22);
    }
    jarGlass.addEventListener("click", jarShake);

    /* optional phone shake */
    let lastShake = 0;
    window.addEventListener("devicemotion", (e)=>{
      const a = e.accelerationIncludingGravity;
      if(!a) return;
      const now = Date.now();
      const mag = Math.abs(a.x||0) + Math.abs(a.y||0) + Math.abs(a.z||0);
      if(mag > 28 && now - lastShake > 900){
        lastShake = now;
        jarShake();
      }
    });
  let nightReminderTimer = null;
function toggleNight(){
  document.body.classList.toggle("night");
  const isNight = document.body.classList.contains("night");

  if(isNight){
    startNightInstrumental();

    // bikin urutan baru setiap masuk night
    shuffleNightNotes();

    const msg = getNextNightNote();
    toast("soft night", msg, 5200);
    softPing();
    if(navigator.vibrate) navigator.vibrate([60,40,60]);

    clearInterval(nightReminderTimer);
    nightReminderTimer = setInterval(()=>{
      if(!document.body.classList.contains("night")) return;

      const msg2 = getNextNightNote();
      toast("gentle reminder", msg2, 5200);

      softPing();
      if(navigator.vibrate) navigator.vibrate([40,30,40]);
      burst(6);
    }, 90000);
}else{
  clearInterval(nightReminderTimer);
  nightReminderTimer = null;

  stopNightInstrumental(); // langsung panggil

  toast("day mode", "Balik ke pink.\nYang hangatnya tetap sama: aku ada.", 2600);
  burst(8);
}
}
let nightQueue = [];
const nightNotes = [
  "Aku gak mau kamu kuat terus.\nAku mau kamu aman meski cuma sebentar disini.",
  "Kalau kamu lagi lelah pura-pura baik,\nmalam ini kamu boleh jadi versi paling jujur.",
  "Kamu ga perlu jadi versi yang lebih baik malam ini\nCukup jadi kamu dan biar aku yang jagain kamu.",
  "Kalau dunia lagi keras,\naku pengen jadi bagian yang selalu lembut ke kamu.",
  "Aku gak lagi nyari momen yang sempurna.\nAku cuma nyari kamu yang tetap mau tinggal.",
  "Boleh yaa\nmalam ini kamu istirahat dulu,\nbiar besok gak kamu hadapin sendirian."
];
function shuffleNightNotes(){
  nightQueue = [...nightNotes];

  for(let i = nightQueue.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [nightQueue[i], nightQueue[j]] = [nightQueue[j], nightQueue[i]];
  }
}
function getNextNightNote(){
  if(nightQueue.length === 0){
    shuffleNightNotes();
  }
  return nightQueue.pop();
}
/* ===== NIGHT MODE INSTRUMENTAL (WebAudio) ===== */
let nightAudio = {
  ctx:null,
  master:null,
  isOn:false,
  nodes:[],
  timer:null
};

function ensureCtx(){
  if(!nightAudio.ctx){
    nightAudio.ctx = new (window.AudioContext || window.webkitAudioContext)();
  }
  return nightAudio.ctx;
}

/* lembut banget, kayak "alarm notif" tapi nggak nyentak */
function softPing(){
  try{
    const ctx = ensureCtx();
    const t0 = ctx.currentTime;
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = "sine";
    o.frequency.setValueAtTime(784, t0);          // G5
    o.frequency.exponentialRampToValueAtTime(660, t0+0.18);
    g.gain.setValueAtTime(0.0001, t0);
    g.gain.exponentialRampToValueAtTime(0.06, t0+0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, t0+0.22);
    o.connect(g); g.connect(ctx.destination);
    o.start(t0); o.stop(t0+0.25);
  }catch(e){}
}

function startNightInstrumental(){
  if(nightAudio.isOn) return;
  const ctx = ensureCtx();
  nightAudio.isOn = true;

  // master volume (super pelan)
  const master = ctx.createGain();
  master.gain.value = 0.20;
  master.connect(ctx.destination);
  nightAudio.master = master;

  // sedikit "warmth"
  const lp = ctx.createBiquadFilter();
  lp.type = "lowpass";
  lp.frequency.value = 1400;
  lp.Q.value = 0.7;
  lp.connect(master);

  // chord pad (3 oscillator)
  const chord = [220, 277.18, 329.63]; // A3, C#4, E4 (A major vibe, hangat)
  chord.forEach((f, i)=>{
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = (i===1 ? "triangle" : "sine");
    o.frequency.value = f;

    // fade in halus
    const t0 = ctx.currentTime;
    g.gain.setValueAtTime(0.0001, t0);
    g.gain.exponentialRampToValueAtTime(0.12, t0+1.2);

    // slight slow wobble (biar berasa hidup)
    const lfo = ctx.createOscillator();
    const lfoG = ctx.createGain();
    lfo.type = "sine";
    lfo.frequency.value = 0.08 + Math.random()*0.06;
    lfoG.gain.value = 2.2; // detune subtle
    lfo.connect(lfoG);
    lfoG.connect(o.detune);

    o.connect(g); g.connect(lp);
    o.start();
    lfo.start();

    nightAudio.nodes.push(o,g,lfo,lfoG);
  });

  // sparkle lembut (random tiap beberapa detik)
  nightAudio.timer = setInterval(()=>{
    if(!nightAudio.isOn) return;
    const t0 = ctx.currentTime;
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    const bp = ctx.createBiquadFilter();
    bp.type = "bandpass";
    bp.frequency.value = 1800 + Math.random()*900;
    bp.Q.value = 6;

    o.type = "sine";
    o.frequency.value = 660 + Math.random()*520;

    g.gain.setValueAtTime(0.0001, t0);
    g.gain.exponentialRampToValueAtTime(0.08, t0+0.015);
    g.gain.exponentialRampToValueAtTime(0.0001, t0+0.18);

    o.connect(bp); bp.connect(g); g.connect(master);
    o.start(t0);
    o.stop(t0+0.22);
  }, 2400);
}
function stopNightInstrumental(){
  if(!nightAudio.isOn) return;
  nightAudio.isOn = false;

  if(nightAudio.timer){
    clearInterval(nightAudio.timer);
    nightAudio.timer = null;
  }

  try{
    const ctx = nightAudio.ctx;
    if(nightAudio.master && ctx){
      const t0 = ctx.currentTime;
      nightAudio.master.gain.exponentialRampToValueAtTime(0.0001, t0+0.8);
    }
  }catch(e){}

  setTimeout(()=>{
    try{
      nightAudio.nodes.forEach(n=>{
        if(n && n.stop) n.stop();
        if(n && n.disconnect) n.disconnect();
      });
    }catch(e){}
    nightAudio.nodes = [];
  }, 900);
}
    /* initial route */
    if(location.hash){ show(location.hash.replace("#","")); } else { show("home"); }
  </script>
</body>
</html>